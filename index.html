<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script type="text/javascript" src="./data/qrcodejs/qrcode.js"></script>
    <link rel="stylesheet" href="./css/font-awesome-4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/index.css">
</head>
<body>

<script type="text/javascript">

    var ID=localStorage.getItem("summerrockzID");
    if(ID===null) {
        ID = Math.random();
        localStorage.setItem("summerrockzID", ID);
    }



    function getEntries(){
        if(localStorage.summerrockzentries!=undefined) {
            var entries = JSON.parse(localStorage.summerrockzentries);
        }else{
            entries=[];
        }
        return entries
    }

    function saveEntries(){

        entries=getEntries();
        var code=Math.random();
        var date=new Date();

        var event=document.getElementById("event").value;
        var vorname=document.getElementById("Vorname").value;
        var nachname=document.getElementById("Nachname").value;
        var tel=document.getElementById("Telefon").value;
        var gesellschaft=document.getElementById("Gesellschaft").value;
        var anzahl=document.getElementById("Anzahl").value;
        var frauen=document.getElementById("Frauen").value;
        var notizen=document.getElementById("notizen").value;
        var paid=document.getElementById("paid").checked;

        var Wochentag = new Array("Sonntag", "Montag", "Dienstag", "Mittwoch","Donnerstag", "Freitag", "Samstag");
        entries.unshift(new Array(code,event,vorname,nachname,tel,gesellschaft,anzahl,frauen,notizen,paid,Wochentag[date.getDay()] + " " +date.getDate() + "." + (date.getMonth()+1) + "." + date.getFullYear()));
        localStorage.summerrockzentries=JSON.stringify(entries);
        createEtikQR(vorname+ " " + nachname);

        document.getElementById("etik_header").innerHTML="E-Ticket for " + event;
        document.getElementById("etik_name").innerHTML="Name: " + vorname + " " + nachname;
        document.getElementById("etik_Telefon").innerHTML="Phone: " + tel;
        document.getElementById("etik_Anzahl").innerHTML="Amount of people: " + anzahl;
        document.getElementById("etik_Frauen").innerHTML="Girls: " + frauen;
        if(paid){
            document.getElementById("etik_paid").innerHTML='<i class="fa fa-check"></i>';
        }else{
            document.getElementById("etik_paid").innerHTML='<i class="fa fa-close"></i>';
        }

        document.getElementById("home").style.display='none';
        document.getElementById("eticket").style.display='block';

        vorname="";
        nachname="";
        tel="";
        anzahl="";
        frauen="";
        notizen="";
        paid=false;

    }

    function goToHome(){
        document.getElementById("archive").style.display='none';
        document.getElementById("home").style.display='block';
        document.getElementById("qr").style.display='none';
        document.getElementById("archiveLink").className="";
        document.getElementById("homeLink").className="menuActivated";
        document.getElementById("eticket").style.display='none';
    }

    function goToArchive(){
        document.getElementById("archive").style.display='block';
        document.getElementById("home").style.display='none';
        document.getElementById("homeLink").className="";
        document.getElementById("archiveLink").className="menuActivated";
        document.getElementById("eticket").style.display='none';
        buildArchive();
    }

    function createQR(code){
        qr.makeCode(code);
        document.getElementById("qr").style.display='block';
        showDeleteButton(code);
    }

    function createEtikQR(code){
        etikqr.makeCode(code);
        document.getElementById("etik_qr").style.display='block';
    }

    function hideQR(){
        document.getElementById("qr").style.display='none';
        document.getElementById("enteredName").style.display='none';
    }

    function trans(identifier)
    {
        var message = identifier;
        if (__lang != undefined) {
            if (__lang[identifier] != undefined) {
                message = __lang[identifier];
            }
        }
        return message;
    }

    function showDeleteButton(code){
        var buttons=document.getElementsByClassName("deleteButton");
        var i=0;
        while(buttons.length>i){
            buttons[i].className="deleteEntry deleteButton";
            i++;
        }

        document.getElementById(code).className="deleteButton";
    }

    function deleteEntry(entry){
        var entries=getEntries();
        var i=0;
        while(i<entries.length){
            if(entries[i][0]==entry){
                entries.splice(i,1);
            }
            i++;
        }
        localStorage.summerrockzentries=JSON.stringify(entries);
        buildArchive();
    }

    function buildArchive(){


        var entries=getEntries();
        var innerHTML="";
        for(var i= 0; i<entries.length;i++){
            html='<a><div id="entry" onclick="createQR(' + "'" + entries[i][0] + "'" + ')">';
            html+='Event: '+entries[i][1]+'<br />';
            html+='Name: '+entries[i][2]+' '+entries[i][3]+'<br />';
            html+='Phone: '+entries[i][4]+'<br />';
            html+='Tourist party: '+entries[i][5]+'<br />';
            html+='Amount of people: '+entries[i][6]+' / Girls: '+entries[i][7]+'<br />';
            html+='Notice: '+entries[i][8]+'<br />';
            html+='invited: ';
            if(entries[i][9]){
                html+='<i class="fa fa-check"></i>'
            }else{
                html+='<i class="fa fa-close"></i>'
            }
            //html+='<br />Eintrag hinzugef√ºgt am: ' + entries[i][10];
            html+='<p><button id="' + entries[i][0] + '" class="deleteEntry deleteButton" onclick="deleteEntry('+ entries[i][0] +')">Delete</button></p>';
            html+='</div></a>';
            innerHTML+=html;
        }
        innerHTML+='<button id="deleteAll" onClick="deleteAll();">Delete all</button>';
        document.getElementById("archive").innerHTML='<div id="qr"></div><div id="archiveEntries" style="height:300px;overflow:auto;">'+innerHTML+'</div>';
        createQR(entries[0][0]);
    }

    function deleteAll(){
        localStorage.removeItem("summerrockzentries");
        goToHome();
    }

    function einladen(){
        var chk=document.getElementById("einladen");
        var btn=document.getElementById("btn_einladen");
        if(chk.value=="off"){
            chk.value="on";
            btn.textContent="invited";
            btn.className="green";
        }else{
            chk.value="off";
            btn.textContent="Invite";
            btn.className="";
        }
    }


</script>
<div id="content">
    <img id="logo" src="./res/icon/android/mipmap-hdpi/ic_launcher.png" />
    <h4 id="header">Summerrockz Event Organizer</h4>
    <div id="menu">
        <div onclick="goToHome();" id="homeLink" class="menuActivated">Invite</div>
        <div onclick="goToArchive();" id="archiveLink" class>History</div>
    </div>
    <div id="qr"></div>
    <div id="home">
        <div id="enteredName"></div>
        <div onclick="hideQR()" id="qrStart"></div>
        <select id="event">
            <option>Lloret Selected</option>
            <option>Pacha</option>
        </select>
        <table>
            <tr>
                <td><input type="text" id="Vorname" name="Name" placeholder="Lastname" /></td>
                <td><input type="text" id="Nachname" name="Nachname" placeholder="Firstname" /></td>
            </tr>
        </table>
        <input type="number" id="Telefon" name="Telefon" placeholder="Phone" />

        <select id="Gesellschaft">
            <option>Mango Tours</option>
            <option>JAM</option>
            <option>FUN</option>
            <option>Max Tours</option>
            <option>ABI 4 Life</option>
            <option>NEXT</option>
            <option>other</option>
        </select>
        <table>
            <tr>
                <td><input type="number" id="Anzahl" name="gesamt" placeholder="Amount of people" /></td>
                <td><input type="number" id="Frauen" name="Frauen" placeholder="Girls" /></td>
            </tr>
        </table>
        <textarea name="sonstiges" id="notizen" cols="35" rows="4" placeholder="Notice"></textarea>
        <br />
        Full paid <input type="checkbox" id="paid" name="paid" />
        <button onClick="saveEntries();" id="btn_einladen">Invite</button>



    </div>
    <div id="archive"></div>
    <div id="eticket">
    <h3 id="etik_header">E</h3>
        <div id="etik_qr"></div>
        <div id="etik_name"></div>
        <div id="etik_Telefon"></div>
        <div id="etik_Anzahl"></div>
        <div id="etik_Frauen"></div>
        <br />
        Full paid <span id="etik_paid"></span>
    </div>

</div>
<script type="text/javascript">
    document.getElementById("archive").style.display='none';
    document.getElementById("enteredName").style.display='none';
    document.getElementById("qr").style.display='none';
    qr=new QRCode(document.getElementById("qr"),"");
    etikqr=new QRCode(document.getElementById("etik_qr"),"");
    document.getElementById("eticket").style.display='none';

</script>

</body>
</html>
