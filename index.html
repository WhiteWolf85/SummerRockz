<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script type="text/javascript" src="./data/qrcodejs/qrcode.js"></script>
    <script type=”text/javascript” src=”./data/language/messages.{{ app.session.getLocale() }}.js”></script>
    <link rel="stylesheet" href="./css/font-awesome-4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/index.css">
</head>
<body>

<script type="text/javascript">

    var ID=localStorage.getItem("summerrockzID");
    if(ID===null) {
        ID = Math.random();
        localStorage.setItem("summerrockzID", ID);
    }



    function getEntries(){
        if(localStorage.summerrockzentries!=undefined) {
            var entries = JSON.parse(localStorage.summerrockzentries);
        }else{
            entries=[];
        }
        return entries
    }

    function saveEntries(){

        entries=getEntries();
        var code=Math.random();
        var date=new Date();
        var Wochentag = new Array("Sonntag", "Montag", "Dienstag", "Mittwoch","Donnerstag", "Freitag", "Samstag");
        entries.unshift(new Array(code,document.getElementById("event").value,document.getElementById("Vorname").value,document.getElementById("Nachname").value,document.getElementById("Telefon").value,document.getElementById("Gesellschaft").value,document.getElementById("Anzahl").value,document.getElementById("Frauen").value,document.getElementById("notizen").value,document.getElementById("einladen").value,Wochentag[date.getDay()] + " " +date.getDate() + "." + (date.getMonth()+1) + "." + date.getFullYear()));
        localStorage.summerrockzentries=JSON.stringify(entries);
        createQR(code);
    }

    function goToHome(){
        document.getElementById("archive").style.display='none';
        document.getElementById("home").style.display='block';
        document.getElementById("qr").style.display='none';
        document.getElementById("archiveLink").className="";
        document.getElementById("homeLink").className="menuActivated";
    }

    function goToArchive(){
        document.getElementById("archive").style.display='block';
        document.getElementById("home").style.display='none';
        document.getElementById("homeLink").className="";
        document.getElementById("archiveLink").className="menuActivated";
        buildArchive();
    }

    function createQR(code){
        qr.makeCode(code);
        document.getElementById("qr").style.display='block';
        showDeleteButton(code);
    }

    function hideQR(){
        document.getElementById("qr").style.display='none';
        document.getElementById("enteredName").style.display='none';
    }

    function trans(identifier)
    {
        var message = identifier;
        if (__lang != undefined) {
            if (__lang[identifier] != undefined) {
                message = __lang[identifier];
            }
        }
        return message;
    }

    function showDeleteButton(code){
        var buttons=document.getElementsByClassName("deleteButton");
        var i=0;
        while(buttons.length>i){
            buttons[i].className="deleteEntry deleteButton";
            i++;
        }

        document.getElementById(code).className="deleteButton";
    }

    function deleteEntry(entry){
        var entries=getEntries();
        var i=0;
        while(i<entries.length){
            if(entries[i][0]==entry){
                entries.splice(i,1);
            }
            i++;
        }
        localStorage.summerrockzentries.clear;
        localStorage.summerrockzentries=JSON.stringify(entries);
        buildArchive();
    }

    function buildArchive(){


        var entries=getEntries();
        var innerHTML="";
        for(var i= 0; i<entries.length;i++){
            html='<a><div id="entry" onclick="createQR('+"'"+entries[i][0]+"'"+')">';
            html+='Event: '+entries[i][1]+'<br />';
            html+='Name: '+entries[i][2]+' '+entries[i][3]+'<br />';
            html+='Phone: '+entries[i][4]+'<br />';
            html+='Tourist party: '+entries[i][5]+'<br />';
            html+='Amount of people: '+entries[i][6]+' / Girls: '+entries[i][7]+'<br />';
            html+='Notice: '+entries[i][8]+'<br />';
            html+='invited: ';
            if(entries[i][9]=="on"){
                html+='<i class="fa fa-check"></i>'
            }else{
                html+='<i class="fa fa-hacker-news"></i>'
            }
            //html+='<br />Eintrag hinzugefügt am: ' + entries[i][10];
            html+='<p><button id="' + entries[i][0] + '" class="deleteEntry deleteButton" onclick="deleteEntry('+ entries[i][0] +')">Delete</button></p>';
            html+='</div></a>';
            innerHTML+=html;
        }
        document.getElementById("archive").innerHTML='<div id="qr"></div><div id="archiveEntries" style="height:300px;overflow:auto;">'+innerHTML+'</div>';
        createQR(entries[0][0]);
    }

    function einladen(){
        var chk=document.getElementById("einladen");
        var btn=document.getElementById("btn_einladen");
        if(chk.value=="off"){
            chk.value="on";
            btn.textContent="invited";
            btn.className="green";
        }else{
            chk.value="off";
            btn.textContent="Invite";
            btn.className="";
        }
    }


</script>
<div id="content">
    <img src="./res/icon/android/mipmap-hdpi/ic_launcher.png" />

    <div id="menu">
        <div onclick="goToHome();" id="homeLink" class="menuActivated">Invite</div>
        <div onclick="goToArchive();" id="archiveLink" class>History</div>
    </div>
    <div id="qr"></div>
    <table id="home">
        <div id="enteredName"></div>
        <div onclick="hideQR()" id="qrStart"></div>
        <select id="event">
            <option>Event 1</option>
            <option>Event 2</option>
            <option>Event 3</option>
            <option>Event 4</option>
        </select>
        <table>
            <tr>
                <td><input type="text" id="Vorname" name="Name" placeholder="Lastname" /></td>
            <td><input type="text" id="Nachname" name="Nachname" placeholder="Firstname" /></td>
            </tr>
</table>
            <input type="number" id="Telefon" name="Telefon" placeholder="Phone" />

        <select id="Gesellschaft">
            <option>Reisegesellschaft 1</option>
            <option>Reisegesellschaft 2</option>
            <option>Reisegesellschaft 3</option>
            <option>Reisegesellschaft 4</option>
        </select>
        <table>
            <tr>
                <td><input type="number" id="Anzahl" name="gesamt" placeholder="Amount of people" /></td>
                <td><input type="number" id="Frauen" name="Frauen" placeholder="Girls" /></td>
            </tr>
            </table>
        <textarea name="sonstiges" id="notizen" cols="35" rows="4" placeholder="Notice"></textarea>
        <br />
        <button onClick="saveEntries();" id="btn_einladen">Invite</button>
        <input type="checkbox" id="einladen" name="einladen" />


    </div>
    <div id="archive"></div>
</div>
<script type="text/javascript">
    document.getElementById("archive").style.display='none';
    document.getElementById("enteredName").style.display='none';
    document.getElementById("qr").style.display='none';
    qr=new QRCode(document.getElementById("qr"),"");
    document.getElementById("einladen").value="off";

</script>

</body>
</html>
